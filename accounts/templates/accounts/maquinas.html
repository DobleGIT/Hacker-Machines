{%  extends 'accounts/main.html' %}
{% load static %}

{% block content %}

    {% if lista_maquinas %}
    <br> 
        <main role="main" class="container">
            <div class="row">
                <div class="col">
                                   
                    <div class="row">
                        <div class="col-md">
                            <br/>
                            <table class="table align-middle mb-0 bg-white">
                                <thead class="bg-light">
                                    <tr>
                                        <th>Máquina</th>
                                        <th>Categoría</th>
                                        
                                        <th>Dirección IP</th>
                                        <th>Estado</th>
                                        
                                    </tr>
                                </thread>
                                <tbody>
                                    
                                        {% for i in lista_maquinas %}

                                            <tr>
                                                <td>
                                                <div class="d-flex align-items-center">
                                                    <img src="{{i.image_machine.url}}" alt="" style="width: 45px; height: 45px" class="rounded-circle"/>
                                                    <div class="ms-3">
                                                    <a href="{% url 'maquinas' i.nombre_maquina %}" class="fw-normal mb-1" style="margin-left:5px" > {{i.nombre_maquina}} </a>
                                                    </div>
                                                </div>
                                                </td>
                                                <td>
                                                <p class="fw-normal mb-1">{{i.categoria}}</p>
                                                
                                                </td>
                                                
                                                <td>{{i.ip}}</td>
                                                
                                                <td>
                                                    <span class="badge badge-success rounded-pill d-inline">Activa</span>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                            </table>
                        </div>
                    </div>
                            
                </div>
            </div>
                
        </main>

     {% else %}  {% comment %} Esto se muestra si estas en maquinas/UNAMAQUINA {% endcomment %}

        <div class="container-fluid p-4" id="rowTop">
            <img src="{{maquina_individual.image_machine.url}}"  height=150px width=150px class="rounded-circle" id="machinePhotho"/>

        </div>
        <div class="container-fluid p-4" id="rowMiddle">
            <p class="h1 text-center text-white" > {{maquina_individual.nombre_maquina|upper}} </p>
        </div>
        <div class="container-fluid" id="rowDown">
            <div class="container-fluid border-top-0" id="barraNoti">
                <div class="row text-center">
                    <div class="col p-3  text-white text-center" id="barraNoti">
                        
                        <div class="size-30 bold" id="numberTop">{{usersInside}}</div>
                        <div class="size-16 faded">Usuarios han accedido</div>

                    </div>
                    <div class="col p-3  text-white text-center" id="barraNoti">
                        
                        <div class="size-30 bold" id="numberTop">{{usersUserFlag}}</div>
                        <div class="size-16 faded">User Flags totales</div>

                    </div>
                    <div class="col p-3  text-white text-center" id="barraNoti">
                        
                        <div class="size-30 bold" id="numberTop">{{usersRootFlag}}</div>
                        <div class="size-16 faded">Root Flags totales</div>

                    </div>
                  </div>
            </div>
        </div>
        {% if maquina_individual not in request.user.alumno.accesed_machines %} {% comment %} Esto se muestra si NO has entrado en la máquina  {% endcomment %}

            <br/>
            <div class="container" >
                <div class="card">                
                    <div class="card-body">
                        <h5 class="card-title">Descripción</h5>
                        <p class="card-text">{{maquina_individual.descripcion}}</p>
                        <a href="{% url 'access_to_machine' maquina_individual.nombre_maquina %}" class="btn btn-primary">Acceder a la maquina</a>
                    </div>
                </div>
            </div>

        {% elif maquina_individual in request.user.alumno.accesed_machines %} {% comment %} Esto se muestra SI ya has entrado en la máquina  {% endcomment %}

            <br/>
            
            <div class="container" >

                {% comment %} Mostramos los mensajes de alerta {% endcomment %}
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                        </div>
                    {% endfor %}
				{% endif %}

                <div class="card">
                    <div class="card-header">
                      Dirección IP del reto
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5 class="card-title text-right">DIRECCIÓN IP</h5>
                            </div>
                            <div class="col-md-6">
                                <p class="text-center-bold ">{{maquina_individual.ip}}</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                </br>
                

                <div class="card">
                    <div class="card-header text-center">
                        Información de la maquina
                    </div>                
                    <div class="card-body">
                        
                        <form action="" method="POST">
                            {% csrf_token %}
                            <h5 class="card-title">¿Cómo acceder a la máquina?</h5> 
                            <p class="card-text">Para poder acceder a la máquina descargate el archivo de <a href="{% url 'openvpn' %}" class="text-decoration-none">OpenVPN</a> para poder acceder al entorno virtual.</p>
                            
                            <hr>
                        
                            <h5 class="card-title">Descripción</h5> 
                            <p class="card-text">{{maquina_individual.descripcion}}</p>

                            <hr>

                            <h5 class="card-title">Flags</h5> 
                            
                            <p class="card-text">La encontrarás al obtener privilegios de usuario en la máquina.</p>
                            {% if individualUserFlag is False %}    {% comment %}  Comprobamos si el usuario ha averiguado ya la flag {% endcomment %}
                                <div class="input-group mb-4">
                                    <input type="text" name="flagUserInput" class="form-control" placeholder="User Flag" >
                                    
                                    <button class="btn btn-outline-success" type="submit"  style="width:20%;">  Comprobar  </button>
                                    
                                </div>
                            {% else %}
                                <div class="input-group mb-4">
                                    <input type="text" name="flagRootInput" class="form-control" placeholder="Respuesta Correcta" disabled>                                    
                                    <button class="btn btn-outline-success" type="submit"  style="width:20%; background-color:#28a745; color: #fff;" disabled>  Completado  </button>

                                    
                                </div>
                                
                            {% endif %}
                            
                            <p class="card-text">La encontrarás al obtener privilegios de Super Usuario en la máquina.</p>
                            {% if individualRootFlag is False %} {% comment %}  Comprobamos si el usuario ha averiguado ya la flag {% endcomment %}
                                <div class="input-group mb-4">
                                    <input type="text" name="flagRootInput" class="form-control" placeholder="Root Flag" >
                                    
                                    <button class="btn btn-outline-success" type="submit"  style="width:20%;">  Comprobar  </button>
                                    
                                </div>
                            {% else %}
                                <div class="input-group mb-4">
                                    <input type="text" name="flagRootInput" class="form-control" placeholder="Respuesta Correcta" disabled>                                    
                                    <button class="btn btn-outline-success" type="submit"  style="width:20%; background-color:#28a745; color: #fff;" disabled>  Completado  </button>

                                    
                                </div>
                                
                            {% endif %}
                     
                        </form>
                    </div>
                </div>
                <br/>
            </div>

        {% endif %}
        {% comment %} <p> {{request.user.alumno.accesed_machines}} </p> {% endcomment %}
        {% endif %} 
                        
                   


{% endblock content %}